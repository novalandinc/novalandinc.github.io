<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Duplicates Auditor</title>

    <link rel="stylesheet" href="assets/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- CSV parsing -->
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="brand">
        <div class="logo">DA</div>
        <div>
          <div class="title">Duplicates Auditor</div>
          <div class="subtitle">Single CSV (default) ‚Ä¢ Two CSVs (legacy)</div>
        </div>
      </div>

      <div class="header-actions">
        <button
          id="lang-toggle"
          class="icon-button"
          aria-label="Toggle language"
        >
          <span class="icon" aria-hidden="true">üåê</span>
          <span id="lang-label">‰∏≠Êñá</span>
        </button>
      </div>
    </header>

    <main class="container">
      <section class="layout">
        <!-- SIDEBAR -->
        <aside class="sidebar">
          <h3>Getting started</h3>
          <ol class="steps" id="steps">
            <!-- Filled by JS depending on mode -->
          </ol>

          <div class="settings card">
            <div class="group">
              <label for="days-window">Date window (days)</label>
              <input id="days-window" type="number" min="0" value="3" />
            </div>
            <div class="group">
              <label for="amount-window">Amount tolerance ($)</label>
              <input
                id="amount-window"
                type="number"
                min="0"
                step="0.01"
                value="1"
              />
            </div>

            <details>
              <summary>Advanced options</summary>
              <label class="checkbox">
                <input id="norm-vendor" type="checkbox" checked />
                <span
                  >Normalize vendor names (ignore punctuation, LLC/Inc/Co/Corp,
                  ‚ÄúTHE‚Äù; ‚Äú&‚Äù ‚Üí ‚ÄúAND‚Äù)</span
                >
              </label>
            </details>

            <button id="run" class="wide primary">Run detection</button>
            <div id="readiness" class="hint small muted"></div>

            <div
              id="progress-container"
              class="progress-container hidden"
              role="status"
              aria-live="polite"
            >
              <div id="progress-label" class="progress-label">Preparing‚Ä¶</div>
              <div class="progress-bar">
                <div id="progress-fill" class="progress-fill"></div>
              </div>
              <div id="progress-text" class="progress-text">0%</div>
            </div>
          </div>
        </aside>

        <!-- CONTENT -->
        <section class="content">
          <!-- MODE TABS -->
          <div class="tabs" role="tablist" aria-label="Mode">
            <button
              id="tab-single"
              class="tab active"
              role="tab"
              aria-selected="true"
              aria-controls="panel-single"
            >
              Single CSV
            </button>
            <button
              id="tab-legacy"
              class="tab"
              role="tab"
              aria-selected="false"
              aria-controls="panel-legacy"
            >
              Two CSVs (Legacy)
            </button>
          </div>

          <!-- SINGLE MODE PANEL -->
          <section
            id="panel-single"
            class="tab-panel card"
            role="tabpanel"
            aria-labelledby="tab-single"
          >
            <div class="uploader">
              <div>
                <h4>CSV</h4>
                <div id="dz-single" class="dropzone" role="button" tabindex="0">
                  <div class="dz-title">Drop CSV here or click to select</div>
                  <div class="dz-sub">
                    Will auto-detect columns. Typical required fields:
                    <code>EntryDate</code>/<code>entryDate</code> ‚Ä¢
                    <code>VendorName</code>/<code>payeeNameRaw</code> ‚Ä¢
                    <code>Amount</code>/<code>amount</code> ‚Ä¢
                    <code>PropertyName</code>/<code>buildingName</code>
                  </div>
                  <input
                    type="file"
                    id="file-single"
                    accept=".csv,text/csv"
                    hidden
                  />
                </div>
                <button
                  id="single-mapping-toggle"
                  class="secondary small"
                  type="button"
                >
                  Show mapping
                </button>
                <div id="single-info" class="hidden"></div>
              </div>
            </div>

            <section class="results" style="margin-top:16px">
              <details class="acc" open id="acc-single">
                <summary>
                  <span>Duplicates</span>
                  <span class="badge" id="count-single">0</span>
                </summary>
                <div class="acc-body">
                  <div class="result-controls">
                    <input
                      id="filter-single"
                      class="search"
                      type="search"
                      placeholder="Filter vendor/building‚Ä¶"
                    />
                    <div class="segmented" role="group" aria-label="Rows">
                      <button
                        class="seg active"
                        data-scope="single"
                        data-kind="rows"
                        data-value="compact"
                        aria-pressed="true"
                      >
                        Compact
                      </button>
                      <button
                        class="seg"
                        data-scope="single"
                        data-kind="rows"
                        data-value="all"
                        aria-pressed="false"
                      >
                        All rows
                      </button>
                    </div>
                    <div class="segmented" role="group" aria-label="Columns">
                      <button
                        class="seg active"
                        data-scope="single"
                        data-kind="cols"
                        data-value="basic"
                        aria-pressed="true"
                      >
                        Basic
                      </button>
                      <button
                        class="seg"
                        data-scope="single"
                        data-kind="cols"
                        data-value="all"
                        aria-pressed="false"
                      >
                        All columns
                      </button>
                    </div>
                  </div>

                  <div id="dups-single" class="results"></div>
                  <div id="pager-single" class="pager"></div>

                  <div class="row" style="justify-content:flex-end">
                    <button id="export-single" class="secondary small">
                      Download CSV
                    </button>
                  </div>
                </div>
              </details>
            </section>
          </section>

          <!-- LEGACY PANEL (unchanged behavior) -->
          <section
            id="panel-legacy"
            class="tab-panel card hidden"
            role="tabpanel"
            aria-labelledby="tab-legacy"
          >
            <div class="uploader">
              <!-- Unpaid -->
              <div>
                <h4>Unpaid CSV</h4>
                <div id="dz-unpaid" class="dropzone" role="button" tabindex="0">
                  <div class="dz-title">Drop CSV here or click to select</div>
                  <div class="dz-sub">
                    Required: <code>EntryDate</code> ‚Ä¢ <code>VendorName</code> ‚Ä¢
                    <code>Amount</code> ‚Ä¢ <code>PropertyName</code>
                  </div>
                  <input
                    type="file"
                    id="file-unpaid"
                    accept=".csv,text/csv"
                    hidden
                  />
                </div>
                <button
                  id="unpaid-mapping-toggle"
                  class="secondary small"
                  type="button"
                >
                  Show mapping
                </button>
                <div id="unpaid-info" class="hidden"></div>
              </div>

              <!-- Paid -->
              <div>
                <h4>Paid CSV</h4>
                <div id="dz-paid" class="dropzone" role="button" tabindex="0">
                  <div class="dz-title">Drop CSV here or click to select</div>
                  <div class="dz-sub">
                    Required: <code>entryDate</code> ‚Ä¢
                    <code>payeeNameRaw</code> ‚Ä¢ <code>amount</code> ‚Ä¢
                    <code>buildingName</code>
                  </div>
                  <input
                    type="file"
                    id="file-paid"
                    accept=".csv,text/csv"
                    hidden
                  />
                </div>
                <button
                  id="paid-mapping-toggle"
                  class="secondary small"
                  type="button"
                >
                  Show mapping
                </button>
                <div id="paid-info" class="hidden"></div>
              </div>
            </div>

            <!-- RESULTS -->
            <section class="results" style="margin-top:16px">
              <!-- UNPAID -->
              <details class="acc" open id="acc-unpaid">
                <summary>
                  <span>Duplicates: Unpaid</span>
                  <span class="badge" id="count-unpaid">0</span>
                </summary>
                <div class="acc-body">
                  <div class="result-controls">
                    <input
                      id="filter-unpaid"
                      class="search"
                      type="search"
                      placeholder="Filter vendor/building‚Ä¶"
                    />
                    <div class="segmented" role="group" aria-label="Rows">
                      <button
                        class="seg active"
                        data-scope="unpaid"
                        data-kind="rows"
                        data-value="compact"
                        aria-pressed="true"
                      >
                        Compact
                      </button>
                      <button
                        class="seg"
                        data-scope="unpaid"
                        data-kind="rows"
                        data-value="all"
                        aria-pressed="false"
                      >
                        All rows
                      </button>
                    </div>
                    <div class="segmented" role="group" aria-label="Columns">
                      <button
                        class="seg active"
                        data-scope="unpaid"
                        data-kind="cols"
                        data-value="basic"
                        aria-pressed="true"
                      >
                        Basic
                      </button>
                      <button
                        class="seg"
                        data-scope="unpaid"
                        data-kind="cols"
                        data-value="all"
                        aria-pressed="false"
                      >
                        All columns
                      </button>
                    </div>
                  </div>

                  <div id="dups-unpaid" class="results"></div>
                  <div id="pager-unpaid" class="pager"></div>

                  <div class="row" style="justify-content:flex-end">
                    <button id="export-unpaid" class="secondary small">
                      Download CSV
                    </button>
                  </div>
                </div>
              </details>

              <!-- PAID -->
              <details class="acc" id="acc-paid">
                <summary>
                  <span>Duplicates: Paid</span>
                  <span class="badge" id="count-paid">0</span>
                </summary>
                <div class="acc-body">
                  <div class="result-controls">
                    <input
                      id="filter-paid"
                      class="search"
                      type="search"
                      placeholder="Filter vendor/building‚Ä¶"
                    />
                    <div class="segmented" role="group" aria-label="Rows">
                      <button
                        class="seg active"
                        data-scope="paid"
                        data-kind="rows"
                        data-value="compact"
                        aria-pressed="true"
                      >
                        Compact
                      </button>
                      <button
                        class="seg"
                        data-scope="paid"
                        data-kind="rows"
                        data-value="all"
                        aria-pressed="false"
                      >
                        All rows
                      </button>
                    </div>
                    <div class="segmented" role="group" aria-label="Columns">
                      <button
                        class="seg active"
                        data-scope="paid"
                        data-kind="cols"
                        data-value="basic"
                        aria-pressed="true"
                      >
                        Basic
                      </button>
                      <button
                        class="seg"
                        data-scope="paid"
                        data-kind="cols"
                        data-value="all"
                        aria-pressed="false"
                      >
                        All columns
                      </button>
                    </div>
                  </div>

                  <div id="dups-paid" class="results"></div>
                  <div id="pager-paid" class="pager"></div>

                  <div class="row" style="justify-content:flex-end">
                    <button id="export-paid" class="secondary small">
                      Download CSV
                    </button>
                  </div>
                </div>
              </details>

              <!-- CROSS -->
              <details class="acc" id="acc-cross">
                <summary>
                  <span>Paid vs Unpaid</span>
                  <span class="badge" id="count-cross">0</span>
                </summary>
                <div class="acc-body">
                  <div class="result-controls">
                    <input
                      id="filter-cross"
                      class="search"
                      type="search"
                      placeholder="Filter vendor/building‚Ä¶"
                    />
                    <div class="segmented" role="group" aria-label="Rows">
                      <button
                        class="seg active"
                        data-scope="cross"
                        data-kind="rows"
                        data-value="compact"
                        aria-pressed="true"
                      >
                        Compact
                      </button>
                      <button
                        class="seg"
                        data-scope="cross"
                        data-kind="rows"
                        data-value="all"
                        aria-pressed="false"
                      >
                        All rows
                      </button>
                    </div>
                    <div class="segmented" role="group" aria-label="Columns">
                      <button
                        class="seg active"
                        data-scope="cross"
                        data-kind="cols"
                        data-value="basic"
                        aria-pressed="true"
                      >
                        Basic
                      </button>
                      <button
                        class="seg"
                        data-scope="cross"
                        data-kind="cols"
                        data-value="all"
                        aria-pressed="false"
                      >
                        All columns
                      </button>
                    </div>
                  </div>

                  <div id="cross" class="results"></div>
                  <div id="pager-cross" class="pager"></div>

                  <div class="row" style="justify-content:flex-end">
                    <button id="export-cross" class="secondary small">
                      Download CSV
                    </button>
                  </div>
                </div>
              </details>
            </section>
          </section>
        </section>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container">
        <span class="muted small"
          >¬© <span id="year"></span> ‚Ä¢ Duplicates Auditor</span
        >
      </div>
    </footer>

    <script src="assets/app.js"></script>
  </body>
</html>
